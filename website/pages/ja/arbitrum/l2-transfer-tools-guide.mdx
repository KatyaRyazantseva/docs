---
title: L2 転送ツールガイド
---

> L2トランスファーツールはまだリリースされていません。2023年の夏に利用可能と予想されています。

The Graph（ザ・グラフ）は、Arbitrum One上のL2への移行を容易にしました。各プロトコル参加者には、すべてのネットワーク参加者にとってL2への移行をスムーズにするための一連のL2トランスファーツールがあります。これらのツールを使用すると、転送内容に応じて特定の手順に従う必要があります。

これらのツールに関するよくある質問は、 [L2 Transfer Tools FAQ](/arbitrum/l2-transfer-tools-faq) で回答されています。FAQには、ツールの使用方法、動作の仕組み、および使用する際に注意すべきことについての詳細な説明が含まれています。

## サブグラフを Arbitrum (L2) に転送する方法

<VideoEmbed youtube="R8_vz4lx2Co" />

## サブグラフを転送する利点

The Graphのコミュニティとコア開発者は、過去1年間にわたって [been preparing](https://forum.thegraph.com/t/gip-0031-arbitrum-grt-bridge/3305) Arbitrumは、Ethereumからセキュリティを引き継いでいるが、ガス料金が劇的に低いレイヤー2または「L2」のブロックチェーンです。

The Graph Networkにサブグラフを公開またはアップグレードする際には、プロトコル上のスマートコントラクトとやり取りする必要があり、これにはETHを使用してガス料金を支払う必要があります。サブグラフをArbitrumに移行することで、将来のサブグラフの更新にかかるガス料金が大幅に削減されます。低い料金とL2上のキュレーションボンディングカーブがフラットであることから、他のキュレーターがあなたのサブグラフをキュレーションすることが容易になり、その結果、サブグラフ上のインデクサーへの報酬が増加します。この低コスト環境により、インデクサーがサブグラフをインデックスして提供するコストも削減されます。今後数カ月間、Arbitrum上のインデキサーの報酬は増加し、Ethereumメインネット上では減少する予定です。そのため、ますます多くのインデクサーがステークを転送し、L2でのオペレーションを設定することになるでしょう。

## シグナル、L1 サブグラフ、クエリ URL で何が起こるかを理解する

サブグラフをArbitrumに転送する際には、Arbitrum GRTブリッジが使用され、さらにネイティブのArbitrumブリッジを介してサブグラフがL2に送信されます。この「転送」は、メインネット上のサブグラフを非推奨にし、ブリッジを使用してL2上でサブグラフを再作成するための情報を送信します。また、サブグラフのオーナーがシグナルしたGRTも含まれますが、このGRTはブリッジが転送を受け入れるためにゼロより大きい必要があります。

サブグラフを転送することを選択すると、そのサブグラフのすべてのキュレーションシグナルがGRTに変換されます。これは、メインネット上のサブグラフを「非推奨」にするのと同等です。キュレーションに対応するGRTは、サブグラフとともにL2に送信され、L2上であなたの代わりにシグナルを作成するために使用されます。

他のキュレーターは、自分の一部のGRTを引き出すか、または同じサブグラフでシグナルを作成するためにL2に転送するかを選択できます。もしサブグラフのオーナーがサブグラフをL2に転送せず、手動で契約呼び出しを使用して非推奨にする場合、キュレーターは通知され、キュレーションを引き出すことができます。

サブグラフが転送されると、すべてのキュレーションがGRTに変換されるため、インデクサーはサブグラフのインデックス作業に対する報酬を受け取らなくなります。ただし、以下の2つの方法でインデクサーが対応することが考えられます。まず、転送されたサブグラフを24時間提供し続けるインデクサーがいるかもしれません。そして、すぐにL2上のサブグラフをインデックスし始めるインデクサーもいます。これらのインデクサーはすでにサブグラフをインデックスしているため、サブグラフの同期を待つ必要はなく、L2サブグラフをほぼすぐにクエリすることができるでしょう。

L2サブグラフへのクエリは、異なるURL（'arbitrum-gateway.thegraph.com'上）に対して行う必要があります。ただし、L1のURLは少なくとも48時間は引き続き動作します。その後、L1のゲートウェイは一時的にL2のゲートウェイにクエリを転送しますが、これには遅延が発生するため、できるだけ早くすべてのクエリを新しいURLに切り替えることをお勧めします。

## L2 ウォレットの選択

メインネット上でサブグラフを公開する際、サブグラフを作成するために接続されたウォレットを使用しました。このウォレットがこのサブグラフを表すNFTを所有し、更新を公開することを可能にしています。

サブグラフをArbitrumに転送する際、L2上のこのサブグラフNFTを所有する異なるウォレットを選択することができます。

もしMetaMaskのような「通常の」ウォレット（Externally Owned AccountまたはEOA、つまりスマートコントラクトでないウォレット）を使用している場合、これは任意ですが、L1と同じ所有者アドレスを維持することをお勧めします。

スマートコントラクトウォレット（マルチシグなどの例：Safe）を使用している場合、異なるL2ウォレットアドレスを選択することは必須です。おそらくこのアカウントはメインネット上にしか存在せず、このウォレットを使用してArbitrum上でトランザクションを行うことはできないでしょう。もし引き続きスマートコントラクトウォレットやマルチシグを使用したい場合、Arbitrum上で新しいウォレットを作成し、そのアドレスをサブグラフのL2オーナーとして使用してください。

**重要なことは、あなたが制御し、Arbitrum上でトランザクションを行えるウォレットアドレスを使用することです。そうしないと、サブグラフは失われ、回復することができません。**

## 送金の準備: ETH のブリッジング

サブグラフの転送には、まずブリッジを通じてトランザクションを送信し、その後Arbitrumで別のトランザクションを実行する手続きが含まれます。最初のトランザクションはメインネット上のETHを使用し、L2でメッセージが受信される際にガス料金を支払うために一部のETHを含んでいます。ただし、このガス料金が不足している場合、トランザクションを再試行し、L2上でガス料金を直接支払う必要があります（これが下記の「ステップ3：転送の確認」です）。このステップは、転送を開始してから7日以内に実行する必要があります。さらに、2番目のトランザクション（「ステップ4：L2での転送の完了」）は、直接Arbitrumで行われます。そのため、Arbitrumウォレットに一定のETHが必要です。もしマルチシグやスマートコントラクトアカウントを使用している場合、ETHはトランザクションを実行するために使用している通常の（EOA）ウォレットに存在する必要があり、マルチシグウォレット自体には存在しないようにしてください。

いくつかの取引所でETHを購入し、それを直接Arbitrumに引き出すことができます。また、Arbitrumブリッジを使用して、メインネットのウォレットからL2にETHを送信することもできます: [bridge.arbitrum.io](http://bridge.arbitrum.io)。Arbitrum上のガス料金が低いため、わずかな額しか必要ありません。トランザクションが承認されるよう、低い閾値（たとえば0.01 ETHなど）から始めることをお勧めします。

## サブグラフ転送ツールを見つける方法

サブグラフのページをSubgraph Studioで表示している場合、L2転送ツールは次のようにして見つけることができます：

![transfer tool](/img/L2-transfer-tool1.png)

ウォレットがサブグラフを所有しており、そのサブグラフのページに接続している場合、Explorerでも利用可能です。

![Transferring to L2](/img/transferToL2.png)

「L2に転送」ボタンをクリックすると、転送ツールが開き、転送プロセスを開始できます。

## ステップ 1: 転送の開始

転送を開始する前に、L2上でサブグラフを所有するアドレスを決定する必要があります（「L2ウォレットの選択」を参照）。また、既にArbitrumにブリッジされているガス用の一部のETHを持っていることを強くお勧めします（「転送の準備：一部のETHのブリッジ」を参照）。

また、サブグラフを転送するには、同じアカウントでサブグラフに対してゼロでないシグナルが必要です。もしサブグラフにシグナルを送っていない場合、少額のキュレーションを追加する必要があります（1 GRTのような少額でも十分です）。

転送ツールを開いた後、L2ウォレットアドレスを「受信ウォレットアドレス」のフィールドに入力できます。**ここに正しいアドレスを入力していることを確認してください。** サブグラフの転送をクリックすると、ウォレットでトランザクションを実行するように求められます（一定のETH価値が含まれており、L2ガス料金を支払うためのものです）。これにより、転送が開始され、L1サブグラフが非推奨になります（背後で何が行われているかの詳細については、「シグナル、L1サブグラフ、クエリURLの理解」を参照してください）。

このステップを実行する場合、**7日以内にステップ3を完了することを確認してください。そうしないと、サブグラフとシグナルのGRTが失われる可能性があります。** これは、ArbitrumのL1-L2メッセージングの動作に関連しています。ブリッジを介して送信されるメッセージは「リトライ可能なチケット」として、7日以内に実行する必要があり、最初の実行が失敗した場合はArbitrum上のガス価格が急上昇する可能性があるため、再試行が必要です。

![Start the trnasfer to L2](/img/startTransferL2.png)

## ステップ2: サブグラフがL2に到達するのを待つ

転送を開始した後、L1サブグラフをL2に送信するメッセージは、Arbitrumブリッジを介して伝播する必要があります。これには約20分かかります（ブリッジは、トランザクションが潜在的なチェーンの再組織から「安全」であると判断されるメインネットブロックを待ちます）。

この待ち時間が終了すると、ArbitrumはL2の契約上で転送を自動的に実行しようとします。

![Wait screen](/img/screenshotOfWaitScreenL2.png)

## ステップ 3: 転送の確認

ほとんどの場合、ステップ1に含まれるL2ガスは、サブグラフをArbitrumの契約に受け取るトランザクションを実行するために十分であるため、このステップは自動的に実行されるはずです。ただし、一部の場合には、Arbitrum上のガス価格の急上昇が自動実行に失敗する可能性があります。この場合、サブグラフをL2に送信する「チケット」は保留中となり、7日以内に再試行が必要となります。

この場合、Arbitrum上に一定のETHを持つL2ウォレットを使用して接続し、ウォレットネットワークをArbitrumに切り替え、トランザクションを再試行するために「転送の確認」をクリックする必要があります。

![Confirm the transfer to L2](/img/confirmTransferToL2.png)

## ステップ 4: L2 での転送の終了

この時点で、サブグラフとGRTはArbitrum上に受信されていますが、サブグラフはまだ公開されていません。受信ウォレットとして選択したL2ウォレットを使用して接続し、ウォレットネットワークをArbitrumに切り替え、"サブグラフを公開"をクリックする必要があります。

![Publish the subgraph](/img/publishSubgraphL2TransferTools.png)

![Wait for the subgraph to be published](/img/waitForSubgraphToPublishL2TransferTools.png)

以下の操作を行うと、Arbitrum上で動作しているインデクサーは、このサブグラフを提供し始めることができるようになります。また、L1から転送されたGRTを使用してキュレーションシグナルも作成されます。

## ステップ 5: クエリ URL の更新

あなたのサブグラフは無事にArbitrumに転送されました！サブグラフをクエリするための新しいURLは次のとおりです：

`https://arbitrum-gateway.thegraph.com/api/[api-key]/subgraphs/id/[l2-subgraph-id]`

Arbitrum上のサブグラフIDは、メインネット上のものと異なることに注意してください。ただし、常にエクスプローラーまたはスタジオでそのIDを見つけることができます。前述のように（「シグナル、L1サブグラフ、およびクエリURLの動作の理解」を参照）、古いL1 URLはしばらくサポートされますが、サブグラフがL2で同期されたらすぐに新しいアドレスにクエリを切り替える必要があります。

## キュレーションをArbitrum（L2）に転送する方法

## サブグラフがL2に転送される際にキュレーションに何が起こるかを理解する

サブグラフのオーナーがサブグラフをArbitrumに転送する際、サブグラフのすべてのシグナルは同時にGRTに変換されます。これには「自動移行」シグナルも含まれます。つまり、これはサブグラフの特定のバージョンや展開に固有ではなく、サブグラフの最新バージョンに従うシグナルのことです。

このシグナルからGRTへの変換は、サブグラフのオーナーがL1でサブグラフを非推奨化した場合と同じです。サブグラフが非推奨化または転送されると、すべてのキュレーションシグナルは同時に（キュレーションボンディングカーブを使用して）「燃やされ」、その結果得られたGRTはGNSスマートコントラクトに保持されます（これはサブグラフのアップグレードと自動移行シグナルを処理する契約です）。そのサブグラフの各キュレーターは、したがって、彼らが持っていたシェアの量に比例するそのGRTに対する請求権を持っています。

これらのGRTの一部は、サブグラフオーナーに対応する部分が、サブグラフと共にL2に送信されます。

この時点で、キュレートされたGRTはもはやクエリ料金を蓄積しません。したがって、キュレーターは自分のGRTを引き出すか、それをL2の同じサブグラフに移動して新しいキュレーションシグナルを作成するために使用することが選択できます。GRTをこれらの操作を行う必要は特にありません。GRTは無期限に保持でき、誰もがシェアに比例した金額を得ることができます。操作を行うタイミングに関わらずです。

## L2 ウォレットの選択

もしキュレートされたGRTをL2に転送することを決定した場合、L2上でキュレーションシグナルを所有する異なるウォレットを選択することができます。

もしMetamaskのような「通常の」ウォレット（外部所有アカウントまたはEOA、つまりスマートコントラクトでないウォレット）を使用している場合、これは任意です。L1と同じキュレーターアドレスを維持することが推奨されます。

スマートコントラクトウォレット（例：マルチシグのSafe）を使用している場合、異なるL2ウォレットアドレスを選択することが必須です。おそらくこのアカウントはメインネット上のみ存在しており、このウォレットを使用してArbitrum上でトランザクションを行うことはできないでしょう。スマートコントラクトウォレットやマルチシグを引き続き使用したい場合は、Arbitrum上で新しいウォレットを作成し、そのアドレスをL2受信ウォレットアドレスとして使用してください。

**非常に重要なことですが、制御可能なウォレットアドレスを使用し、Arbitrum上でトランザクションを行える必要があります。そうでない場合、キュレーションは失われ、回復することはできません。**

## キュレーションを L2 に送信する: ステップ 1

転送を開始する前に、L2上でキュレーションを所有するアドレスを決定する必要があります（前述の「L2ウォレットの選択」を参照）。また、L2でメッセージの実行を再試行する必要がある場合に備えて、ガスのためのいくつかのETHをArbitrumにブリッジしておくことをお勧めします。ETHをいくつかの取引所で購入し、直接Arbitrumに引き出すこともできます。または、Arbitrumブリッジを使用してメインネットのウォレットからL2にETHを送信することもできます：[bridge.arbitrum.io](http://bridge.arbitrum.io) - Arbitrumのガス料金が非常に低いため、小額、例えば0.01 ETHは十分以上であるはずです。

もしキュレーターとして選んだサブグラフがL2に転送された場合、エクスプローラー上でそのサブグラフをキュレーションしていることが示されるメッセージが表示されるでしょう。

サブグラフのページを表示する際に、キュレーションを引き出すか転送するかを選択できます。"Transfer Signal to Arbitrum" をクリックすると、転送ツールが開きます。

![Transfer signal](/img/transferSignalL2TransferTools.png)

転送ツールを開いた後、ウォレットにETHがない場合、ETHを追加するよう求められるかもしれません。その後、L2ウォレットアドレスを「Receiving wallet address」フィールドに入力できるようになります - **ここに正しいアドレスを入力したことを確認してください。**"Transfer Signal" をクリックすると、ウォレットでトランザクションを実行するよう求められます（L2ガスの支払いに使用するために一定のETH値が含まれています）。これにより、転送が開始されます。

このステップを実行する場合、 **手続きを開始してからステップ3を7日以内に完了させるようにしてください。そうしないと、シグナルGRTは失われてしまいます。** これは、ArbitrumのL1-L2メッセージングの仕組みに起因しています。ブリッジを介して送信されるメッセージは「再試行可能なチケット」であり、7日以内に実行される必要があります。初回の実行が、Arbitrum上でガス価格が急上昇する場合にリトライが必要なことがあります。

## Sending curation to L2: step 2

Starting the transfer:

![Send signal to L2](/img/sendingCurationToL2Step2First.png)

After you start the transfer, the message that sends your L1 curation to L2 must propagate through the Arbitrum bridge. This takes approximately 20 minutes (the bridge waits for the mainnet block containing the transaction to be "safe" from potential chain reorgs).

この待ち時間が終了すると、ArbitrumはL2の契約上で転送を自動的に実行しようとします。

![Sending curation signal to L2](/img/sendingCurationToL2Step2Second.png)

## Sending curation to L2: step 3

In most cases, this step will auto-execute as the L2 gas included in step 1 should be sufficient to execute the transaction that receives the curation on the Arbitrum contracts. In some cases, however, it is possible that a spike in gas prices on Arbitrum causes this auto-execution to fail. In this case, the "ticket" that sends your curation to L2 will be pending and require a retry within 7 days.

この場合、Arbitrum上に一定のETHを持つL2ウォレットを使用して接続し、ウォレットネットワークをArbitrumに切り替え、トランザクションを再試行するために「転送の確認」をクリックする必要があります。

![Send signal to L2](/img/L2TransferToolsFinalCurationImage.png)

## Withdrawing your curation on L1

If you prefer not to send your GRT to L2, or you'd rather bridge the GRT manually, you can withdraw your curated GRT on L1. On the banner on the subgraph page, choose "Withdraw Signal" and confirm the transaction; the GRT will be sent to your Curator address.
